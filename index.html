<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <script src="https://unpkg.com/pdf-lib@1.17.1/dist/pdf-lib.min.js"></script>
   
    <title>Casa do Mar</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.3.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/1.5.3/jspdf.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.18.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.13/jspdf.plugin.autotable.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jszip@3.7.1/dist/jszip.min.js"></script>  
    <script src="https://cdn.jsdelivr.net/npm/file-saver@2.0.2/dist/FileSaver.min.js"></script>

    <style>
        body {
            font-family: calibri, sans-serif;
            background-color: #f2f6fa;
            color: #333;

        }

/* Centraliza o container do formulário */
.container {
    max-width: 800px;
    margin: 0 auto;
    padding: 20px;
    background-color: #fff;
    border-radius: 5px;
    box-shadow: 0 0 10px rgba(0, 0, 0, 0.1);
    display: flex;
    flex-wrap: wrap;
    justify-content: center;
    align-items: center; /* Alinhar verticalmente */
    gap: 20px; /* Espaçamento entre os elementos */


/* Estiliza o Título Geral */

        h1 {
            text-align: center;
            color: #004080;
            
        }

.titulo-e-imagem {
  display: flex;
  align-items: center; /* Alinhar verticalmente */
  justify-content: center; /* Alinhar horizontalmente */  border: 2px solid #004080;
  border-radius: 5px;
  padding: 5px 10px;
  width: 100%;
}

.titulo {
  margin-right: 40px; /* Espaço entre o texto e a imagem */
}

.imagem {
  width: auto;
  height: 45px;
}


/* Estiliza o formulário para centralizar e justificar */

form {
    width: 100%;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between; /* Distribui o espaço igualmente */
    align-items: baseline; /* Alinha verticalmente à base */
    gap: 5px;
    

/* Estiliza os rótulos */

        label {
            display: block;
            font-weight: bold;
            font-size: 13px;
            color: #004080;
            margin-bottom: 4px;
                    }

.label-inferior {
    font-weight: normal;
    font-size: 12px; /* Tamanho da fonte */
    color: #004080; /* Cor do texto */
    margin-top: 2px; /* Margem superior */
    display: block; /* Exibir como bloco */
}

.label-inferior-pgto {
    
    font-size: 14px; /* Tamanho da fonte */
    color: #004080; /* Cor do texto */
    margin-top: 6px; /* Margem superior */
    display: block; /* Exibir como bloco */
   }

/* Estiliza os títulos das sessões */

        .section-title {
            background-color: #004080;
            width: 100%;
            padding: 5px;
            border-radius: 5px;
            margin-bottom: 10px;
            margin-top: 10px;
            color: #ffffff;
            font-weight: bold;
            text-align: center;
        }

 .section-diviser {
            background-color: #F8F9FA;
            width: 100%;
            padding: 1px;
            border: 1px solid #E2E3E3;
            border-radius: 5px;
            margin-bottom: 10px;
            margin-top: 10px;
            color: #004080;
            font-weight: bold;
            text-align: center;
            font-size: 14px;
        }


/* Caixas de Entrada de Texto */
       
input, select {
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f8f9fa;
    text-align: left; /* Texto alinhado à esquerda */
    box-sizing: border-box; /* Inclui padding e borda na largura total */
    }


/* Centralizar conteúdo caixas de entrada de texto */

.styled-input {    
    text-align: center;
    width: 100%;
    padding: 6px;
    border: 1px solid #ccc;
    border-radius: 5px;
    background-color: #f8f9fa;
    box-sizing: border-box; /* Inclui padding e borda na largura total */
   }

/* Centralizar conteúdo e estilizar Caixa Valor Total */

.styled-input-valortotal {    
    text-align: center;
    font-weight: bold;
    background-color: #e8f3ff;
    border: 1px solid #004080;
   }
        

 /* Dimensões Caixas de Texto - Grupos de Formulário */            
         
.form-group40 { width: calc(40% - 8px); }
.form-group30 { width: calc(30% - 6px); }
.form-group33 { width: calc(33.33% - 7px); }
.form-group80 { width: calc(80% - 8px); }
.form-group20 { width: calc(20% - 2px); }
.form-group60 { width: calc(60% - 12px); }
.form-group201 { width: calc(20% - 4px); }


        .form-group.full-width {
            width: 100%;
        }

 
/* Alerta de Erro */

.error-message {
    color: red;
    font-size: 11px;
    margin-top: 2px;
    display: none;
}



/* Área de Pagamento */

.form-group-pgto {
    width: 45%;
    display: flex;
    flex-wrap: wrap;
    justify-content: space-between;
    align-items: center; /* Alinhar verticalmente */
    text-align: center;

}


/* BOTÕES DE AÇÃO */

.botoes-acoes {
  display: flex;
  justify-content: space-between;
  align-items: stretch;
  gap: 10px;
  width: 100%;
  margin-top: 20px;
}

.botoes-acoes button {
  flex: 1; /* cada botão ocupa espaço igual */
  padding: 10px 0;
  font-weight: bold;
  background-color: #e6e6e6;
  color: #212121;
  border: 0px solid #004080;
  border-radius: 5px;
  cursor: pointer;
}

.botoes-acoes button:hover {
  background-color: #cccccc;
}

    // SMARTPHONE

@media (max-width: 768px) {
  .form-group10,
  .form-group20,
  .form-group201,
  .form-group25,
  .form-group30,
  .form-group33,
  .form-group35,
  .form-group40,
  .form-group45,
  .form-group60,
  .form-group80,
  .form-group100,
  .form-group-full {
    width: 100% !important;
  }

  .form-row {
    flex-direction: column;
    gap: 0;
  }
}


</style>
</head>


<body>

    <div class="container">

      <div class="titulo-e-imagem">
  <h1 class="titulo">Cadastro de Reserva</h1>
  <img src="casa_do_mar.png" alt="Casa do Mar" class="imagem">
</div>

<form id="reservaForm" enctype="multipart/form-data">

<!-- Dados do Hóspede -->
        <div class="section-title">DADOS DO HÓSPEDE</div>
   
            <div class="form-group60">
                <label for="nomeHospede">NOME COMPLETO*</label>
                <input type="text" id="nomeHospede" name="nomeHospede">
            </div>
            
           <div class="form-group201">
                <label for="nascimentoHospede">NASCIMENTO*</label>
                <input type="text" id="nascimentoHospede" name="nascimentoHospede" class="styled-input" placeholder="dd/mm/aaaa" onfocus="this.placeholder = ''" oninput="formatarData(this)" onblur="validarData(this)">
                <span id="dataError" class="error-message">Data inválida</span>
           </div>


           <div class="form-group201">
               <label for="cpfHospede">CPF*</label>
               <input type="text" id="cpfHospede" name="cpfHospede" placeholder="000.000.000-00" onfocus="this.placeholder = ''" oninput="formatarCPF(this)" onblur="validarCPF(this)" class="styled-input">
                <span id="cpfError" class="error-message">CPF inválido</span>
            </div>

            <div class="form-group80">
                <label for="enderecoHospede">ENDEREÇO* (logradouro, n°, bairro, complemento)</label>
                <input type="text" id="enderecoHospede" name="enderecoHospede">
            </div>

          <div class="form-group20">
               <label for="cepHospede">CEP*</label>
               <input type="text" id="cepHospede" name="cepHospede" placeholder="00000-000" onfocus="this.placeholder = ''" oninput="formatarCEP(this)" onblur="validarCEP(this)" class="styled-input">
               <span id="cepError" class="error-message">CEP inválido</span>
           </div>

           <div class="form-group40">
                <label for="cidadeHospede">CIDADE/UF - PAÍS*</label>
                <input type="text" id="cidadeHospede" name="cidadeHospede">
            </div>


            <div class="form-group30">
               <label for="telefoneHospede">TELEFONE*</label>
               <input type="text" id="telefoneHospede" name="telefoneHospede" placeholder="+55 (00) 00000-0000" onfocus="this.placeholder = ''"  oninput="formatarTelefone(this)"                    onblur="validarTelefone(this)" class="styled-input">
               <span id="telefoneError" class="error-message">Telefone inválido</span>
            </div> 

            <div class="form-group30">
              <label for="emailHospede">E-MAIL*</label>
             <input type="email" id="emailHospede" name="emailHospede" placeholder="nome@exemplo.com" onfocus="this.placeholder = ''" onblur="validarEmail(this)" class="styled-input">
             <span id="emailError" class="error-message">E-mail inválido</span>
            </div>
 
          
<!-- Dados da Locação -->

<div class="section-title">
  DADOS DA LOCAÇÃO | N° <span id="numeroReserva" style="font-weight: bold;"></span>
</div>

            <div class="form-group33">
                <label for="checkin">CHECK-IN</label>
                <input type="date" id="checkin" name="checkin" class="styled-input">
            </div>
            <div class="form-group33">
                <label for="checkout">CHECK-OUT</label>
                <input type="date" id="checkout" name="checkout" disabled class="styled-input">
            </div>
            <div class="form-group33">
                <label for="numNoites">NOITES (mínimo 2)</label>
                <input type="number" id="numNoites" name="numNoites" class="styled-input" readonly>
            </div>

           <div class="form-group33">
    <label for="numHospedes">HÓSPEDE(S)</label>
    <input type="number" id="hospedes" name="hospedes" value="1" min="1" max="12" class="styled-input">
    <label for="numHospedes" class="label-inferior">máximo 12</label>
<span id="hospedesError" class="error-message">Limite ultrapassado</span>

</div>

<div class="form-group33">
    <label for="numCriancas">CRIANÇA(S)</label>
    <input type="number" id="criancas" name="criancas" value="0" min="0" max="12" class="styled-input">
    <label for="criancas" class="label-inferior">até 2 anos</label>
<span id="criancasError" class="error-message">Limite ultrapassado</span>

</div>


<div class="form-group33" style="position: relative;">
  <label for="valorDiaria">VALOR DA DIÁRIA (R$)</label>
  <input type="number" id="valorDiaria" name="valorDiaria" value="600" class="styled-input" readonly>
  <span id="toggleDiaria" onclick="alternarCampo('valorDiaria', 'toggleDiaria')" 
      style="position:absolute; top: 25px; right: 10px; cursor: pointer;">
  <i class="fas fa-lock" style="color:#004080; font-size: 15px;"></i>
</span>

  <label for="valorDiaria" class="label-inferior">até 6 pessoas o valor é fixo</label>
</div>

<div class="form-group33" style="position: relative;">
  <label for="taxaLimpeza">TAXA DE LIMPEZA (R$)</label>
  <input type="number" id="taxaLimpeza" name="taxaLimpeza" value="300" class="styled-input" readonly>
  <span id="toggleLimpeza" onclick="alternarCampo('taxaLimpeza', 'toggleLimpeza')" style="position:absolute; top: 25px; right: 10px; cursor: pointer;">
  <i class="fas fa-lock" style="color:#004080; font-size: 15px;"></i>
</span>
</div>


            <div class="form-group33">
                <label for="desconto">DESCONTO (%)</label>
                <input type="number" id="desconto" name="desconto" class="styled-input">
                <label for="desconto" class="label-inferior">*não incide sobre a Taxa de Limpeza</label> 
            </div>

<div class="form-group33" style="position: relative;">
  <label for="valorTotal">TOTAL (R$)</label>
  <input type="text" id="valorTotal" name="valorTotal" value="0,00" class="styled-input-valortotal" readonly>
  <span id="toggleTotal" onclick="alternarCampo('valorTotal', 'toggleTotal')" 
        style="position:absolute; top: 25px; right: 10px; cursor: pointer;">
    <i class="fas fa-lock" style="color:#004080; font-size: 15px;"></i>
  </span>
</div>



<!-- Forma de Pagamento -->

<div class="section-title">DADOS DE PAGAMENTO</div>

<div class="form-group33">
  <label for="numParcelas">NÚMERO DE PARCELAS:</label>
  <input type="number" id="numParcelas" name="numParcelas" min="1" max="12" value="1" class="styled-input" oninput="calcularValorParcela()">
</div>

<div class="form-group33">
  <label for="valorParcela">VALOR DA PARCELA (R$):</label>
  <input type="text" id="valorParcela" name="valorParcela" class="styled-input" readonly>

</div>

<div class="form-group33">
<label for="altaEstacao">ALTA ESTAÇÃO (%)</label>
<input type="number" id="altaEstacao" name="altaEstacao" class="styled-input" placeholder="exemplo: 35">
<label for="altaEstacao" class="label-inferior">*dezembro/janeiro/fevereiro</label> 

</div>


<!-- Botões de Ações -->
<div class="botoes-acoes">
  <input type="file" id="arquivoJSON" accept=".json" style="display: none;" onchange="carregarJSON()" />
  <button type="button" onclick="document.getElementById('arquivoJSON').click()">Carregar Dados</button>
  <button type="button" onclick="salvarJSON()">Salvar Dados</button>
  <button type="button" onclick="gerarPDF()">Gerar Reserva</button>
</form>
</div>



<script>


document.getElementById('hospedes').addEventListener('blur', function () {
    const valor = parseInt(this.value);
    const erro = document.getElementById('hospedesError');

    if (valor > 12) {
        erro.style.display = 'inline';
        this.focus();
        this.select();
    } else {
        erro.style.display = 'none';
    }
});

document.getElementById('criancas').addEventListener('blur', function () {
    const valor = parseInt(this.value);
    const erro = document.getElementById('criancasError');

    if (valor > 12) {
        erro.style.display = 'inline';
        this.focus();
        this.select();
    } else {
        erro.style.display = 'none';
    }
});



// Atualiza o campo RESERVA N° com a data do check-in no formato ddmmaaaa
function atualizarNumeroReserva() {
    const checkin = document.getElementById('checkin').value;
    if (checkin) {
        // checkin vem no formato yyyy-mm-dd
        const [ano, mes, dia] = checkin.split("-");
        document.getElementById('numeroReserva').textContent = `${dia}${mes}${ano}`;
    } else {
        document.getElementById('numeroReserva').textContent = '';
    }
}

function validarData(campo) {
    const dataPattern = /^(0[1-9]|[12][0-9]|3[01])\/(0[1-9]|1[0-2])\/(19|20)\d\d$/;
    const dataError = document.getElementById('dataError');
    if (!dataPattern.test(campo.value)) {
        dataError.style.display = 'inline';
    } else {
        dataError.style.display = 'none';
    }
}

document.getElementById('nascimentoHospede').addEventListener('keypress', function(event) {
    if (isNaN(String.fromCharCode(event.which)) && String.fromCharCode(event.which) !== '/') {
        event.preventDefault(); // Previne a entrada de texto
    }
});


// Função Data Atual


 function formatarData(data) {
            const dia = String(data.getDate()).padStart(2, '0');
            const mes = String(data.getMonth() + 1).padStart(2, '0'); // Janeiro é 0!
            const ano = data.getFullYear();
            return `${dia}${mes}${ano}`; // Sem barras
        }




// Função formatar e validar CPF
 
function formatarCPF(campo) {
    let valor = campo.value.replace(/\D/g, '');
    if (valor.length > 11) {
        valor = valor.slice(0, 11);
    }
    valor = valor.replace(/(\d{3})(\d)/, '$1.$2')
                 .replace(/(\d{3})(\d)/, '$1.$2')
                 .replace(/(\d{3})(\d{1,2})$/, '$1-$2');
    campo.value = valor;
}

function validarCPF(campo) {
    const cpfPattern = /^\d{3}\.\d{3}\.\d{3}-\d{2}$/;
    const cpfError = document.getElementById('cpfError');
    if (!cpfPattern.test(campo.value)) {
        cpfError.style.display = 'inline';
    } else {
        cpfError.style.display = 'none';
    }
}

// Função formatar e validar CEP

function formatarCEP(campo) {
    let valor = campo.value.replace(/\D/g, '');
    if (valor.length > 8) {
        valor = valor.slice(0, 8);
    }
    valor = valor.replace(/(\d{5})(\d)/, '$1-$2');
    campo.value = valor;
}

function validarCEP(campo) {
    const cepPattern = /^\d{5}-\d{3}$/;
    const cepError = document.getElementById('cepError');
    if (!cepPattern.test(campo.value)) {
        cepError.style.display = 'inline';
    } else {
        cepError.style.display = 'none';
    }
}

// Função formatar e validar Telefone

function formatarTelefone(campo) {
    let valor = campo.value.replace(/[^+\d]/g, ''); // Mantém apenas dígitos e o símbolo +

    // Remove tudo que não for número ou "+" no início
    if (!valor.startsWith("+")) {
        valor = "+" + valor;
    }

    // Tenta formatar se tiver ao menos 13 caracteres (ex: +55XXXXXXXXXXX)
    if (valor.length >= 13) {
        valor = valor.replace(/^(\+\d{1,3})(\d{2})(\d{5})(\d{4}).*$/, '$1 ($2) $3-$4');
    }

    campo.value = valor;
}

function validarTelefone(campo) {
    const telefonePattern = /^\+\d{1,3} \(\d{2}\) \d{5}-\d{4}$/;
    const telefoneError = document.getElementById('telefoneError');

    if (!telefonePattern.test(campo.value)) {
        telefoneError.style.display = 'inline';
    } else {
        telefoneError.style.display = 'none';
    }
}

document.getElementById('telefoneHospede').addEventListener('keypress', function(event) {
    if (isNaN(String.fromCharCode(event.which))) {
        event.preventDefault(); // Previne a entrada de texto
    }
});


// Função validar Email

function validarEmail(campo) {
    const emailPattern = /^[^\s@]+@[^\s@]+\.[^\s@]+$/;
    const emailError = document.getElementById('emailError');

    if (!emailPattern.test(campo.value)) {
        emailError.style.display = 'inline';
    } else {
        emailError.style.display = 'none';
    }
}



// Função para calcular o número de dias entre as datas de checkin e checkout  

function calcularNoites() {   
  const checkin = document.getElementById('checkin').value;   
  const checkout = document.getElementById('checkout').value;   
  const noites = document.getElementById('numNoites');   
   
  if (checkin && checkout) {   
   const dataCheckin = new Date(checkin);   
   const dataCheckout = new Date(checkout);   
   const diferenca = dataCheckout.getTime() - dataCheckin.getTime();   
   const noitesCalculadas = Math.round(diferenca / (1000 * 3600 * 24));   
   
   noites.value = noitesCalculadas;   
   atualizarValorTotal(); // Chama a função atualizarValorTotal() aqui
  }   
}  



// Função para bloquear/desbloquear campos

function alternarCampo(idCampo, idCadeado) {
    const campo = document.getElementById(idCampo);
    const icone = document.querySelector(`#${idCadeado} i`);

    if (campo.readOnly) {
        campo.readOnly = false;
        icone.classList.remove('fa-lock');
        icone.classList.add('fa-lock-open');
    } else {
        campo.readOnly = true;
        icone.classList.remove('fa-lock-open');
        icone.classList.add('fa-lock');

        // Se o campo for valorDiaria, atualiza o valor na configuração
        if (idCampo === 'valorDiaria') {
            configuracoes.valorDiaria = parseFloat(campo.value);
        }

        // Se o campo for taxaLimpeza, atualiza também
        if (idCampo === 'taxaLimpeza') {
            configuracoes.taxaLimpeza = parseFloat(campo.value);
        }

        atualizarDiaria();
        atualizarValorTotal();
    }
}
  

// Regras do Calendário para mínimo de 2 noites  

document.getElementById('checkin').addEventListener('change', function() {
    var checkinDate = new Date(this.value);
    var checkoutDateInput = document.getElementById('checkout');
    
    if (checkinDate) {
      // Habilitar o campo de data de check-out
      checkoutDateInput.disabled = false;
      
      // Calcular a data mínima para o check-out (dois dias após o check-in)
      var minCheckoutDate = new Date(checkinDate);
      minCheckoutDate.setDate(minCheckoutDate.getDate() + 2);
      
      // Definir o valor mínimo do campo de data de check-out
      checkoutDateInput.min = minCheckoutDate.toISOString().split('T')[0];
    }
  });


// Adiciona evento de mudança nos campos de data para calcular as noites  

document.getElementById('checkin').addEventListener('change', calcularNoites);  
document.getElementById('checkout').addEventListener('change', calcularNoites);
  
// Bloqueia o campo "noite" para somente leitura  
document.getElementById('numNoites').readOnly = true;


// Função fomratar valor total em milhar 

function formatarValorTotal(valor) {
    // Converte para número flutuante
    valor = parseFloat(valor).toFixed(2);
    
    // Se não for um número válido, retorna zero
    if (isNaN(valor)) {
        return '0,00';
    }

    // Converte o ponto decimal para vírgula
    valor = valor.replace(".", ",");

    // Adiciona os pontos de milhar
    valor = valor.replace(/\B(?=(\d{3})+(?!\d))/g, ".");

    return valor;
}

 
// Função para atualizar o valor total 
 
function atualizarValorTotal() {

const campoTotal = document.getElementById('valorTotal');
if (!campoTotal.readOnly) {
    return; // Se estiver desbloqueado, não sobrescreve o valor manual
}
    const noites = parseInt(document.getElementById('numNoites').value);
    const diaria = parseFloat(document.getElementById('valorDiaria').value);
    const desconto = parseFloat(document.getElementById('desconto').value);
    const taxaLimpeza = parseFloat(document.getElementById('taxaLimpeza').value);
    const valorTotal = document.getElementById('valorTotal');

    if (!isNaN(noites) && !isNaN(diaria)) {
        let valorBase = noites * diaria;
        
        if (!isNaN(desconto) && desconto > 0) {
            valorBase = valorBase * (1 - (desconto / 100));
        }

        const valorTotalCalculado = valorBase + (isNaN(taxaLimpeza) ? 0 : taxaLimpeza);

        valorTotal.value = formatarValorTotal(valorTotalCalculado.toFixed(2));
    } else {
        valorTotal.value = '0,00';
    }

    calcularValorParcela();
}


  
// Chama a função ao alterar o valor de qualquer um dos campos  
document.getElementById('numNoites').addEventListener('onchange', atualizarValorTotal);  
document.getElementById('valorDiaria').addEventListener('onchange', atualizarValorTotal);  
document.getElementById('desconto').addEventListener('input', atualizarValorTotal);  
document.getElementById('taxaLimpeza').addEventListener('onchange', atualizarValorTotal);  
  
// Chama a função ao carregar a página  
atualizarValorTotal();
calcularValorParcela();
document.getElementById('taxaLimpeza').readOnly = true;


// Função Calcular Parcela  

function calcularValorParcela() {
  const numParcelas = parseInt(document.getElementById('numParcelas').value);
  let valorTotal = document.getElementById('valorTotal').value;

  valorTotal = valorTotal.replace(/\./g, '').replace(',', '.');
  valorTotal = parseFloat(valorTotal);

  if (!isNaN(valorTotal) && numParcelas >= 1) {
    const valorParcela = valorTotal / numParcelas;
    document.getElementById('valorParcela').value = valorParcela
      .toFixed(2)
      .replace('.', ',')
      .replace(/\B(?=(\d{3})+(?!\d))/g, ".");
  } else {
    document.getElementById('valorParcela').value = '';
  }
}


function atualizarDiariaComAltaEstacao() {
    const hospedes = parseInt(document.getElementById('hospedes').value, 10);
    const diariaBase = configuracoes.valorDiaria;
    const diariaElement = document.getElementById('valorDiaria');
    const altaEstacao = parseFloat(document.getElementById('altaEstacao').value);

    let diariaCalculada = diariaBase;

    // Adiciona valor por hóspede extra (se houver)
    if (hospedes > 6 && hospedes <= 12) {
        const valorHospedeExtra = diariaBase / 6;
        diariaCalculada += (hospedes - 6) * valorHospedeExtra;
    }

    // Aplica acréscimo de alta estação
    if (!isNaN(altaEstacao) && altaEstacao > 0) {
        diariaCalculada *= (1 + altaEstacao / 100);
    }

    diariaElement.value = diariaCalculada.toFixed(2);

    atualizarValorTotal(); // Atualiza total e parcelas
}



function syncValues() {
    var taxaLimpezaConfig = document.getElementById('taxaLimpezaConfig').value;
    document.getElementById('taxaLimpeza').value = taxaLimpezaConfig;
  }

  // Para sincronizar o valor inicial
  window.addEventListener('DOMContentLoaded', (event) => {
    syncValues();
  });


// Função Configuração

const configuracoes = {
    valorDiaria: 600,   // atualizar valor da diária
    taxaLimpeza: 300
};

function sincronizarTaxaLimpeza() {
    document.getElementById('taxaLimpeza').value = configuracoes.taxaLimpeza;
}


// Chama a função ao alterar o valor do campo 'Hóspedes'
document.getElementById('hospedes').addEventListener('change', atualizarDiariaComAltaEstacao);
document.getElementById('altaEstacao').addEventListener('input', atualizarDiariaComAltaEstacao);




 // Gerar PDF

async function gerarPDF() {
  const { PDFDocument, rgb, StandardFonts } = PDFLib;

  // Carrega a imagem de fundo
  const fundoBytes = await fetch('CADASTRO RESERVA.png').then(res => res.arrayBuffer());

  // Cria o PDF
  const pdfDoc = await PDFDocument.create();
  const page = pdfDoc.addPage([595, 842]); // A4

  // Adiciona imagem de fundo
  const fundoImg = await pdfDoc.embedPng(fundoBytes);
  page.drawImage(fundoImg, {
    x: 0,
    y: 0,
    width: 595,
    height: 842
  });

  const font = await pdfDoc.embedFont(StandardFonts.Helvetica);

   // Coleta dados do formulário

  const nome = document.getElementById("nomeHospede").value;
  const nascimento = document.getElementById("nascimentoHospede").value;
  const cpf = document.getElementById("cpfHospede").value;
  const telefone = document.getElementById("telefoneHospede").value;
  const endereco = document.getElementById("enderecoHospede").value;
  const cep = document.getElementById("cepHospede").value;
  const cidade = document.getElementById("cidadeHospede").value;
  const email = document.getElementById("emailHospede").value;
  
  const numeroReserva = document.getElementById("numeroReserva").textContent;
  const checkin = document.getElementById("checkin").value;
  const checkout = document.getElementById("checkout").value;

function formatarDataParaPDF(dataISO) {
    if (!dataISO) return '';
    const [ano, mes, dia] = dataISO.split("-");
    return `${dia}/${mes}/${ano}`;
}

const checkinFormatado = formatarDataParaPDF(checkin);
const checkoutFormatado = formatarDataParaPDF(checkout);

  const numNoites = document.getElementById("numNoites").value;
  const numHospedes = document.getElementById("hospedes").value;
  const numCriancas = document.getElementById("criancas").value;

  const valorDiaria = document.getElementById("valorDiaria").value;
  const taxaLimpeza = document.getElementById("taxaLimpeza").value;
  const desconto = document.getElementById("desconto").value;
  const total = document.getElementById("valorTotal").value;
  const formaPagamento = document.querySelector('input[name="pagamento"]:checked')?.value || "".value;
  const numParcelas = document.getElementById("numParcelas").value;
  const valorParcela = document.getElementById("valorParcela").value;

  // Estilo dos textos
  const estilo = {
    size: 11,
    font,
    color: rgb(0, 0, 0)
  };

  // Preenchimento dos dados no PDF (coordenadas ajustadas para o modelo)

  page.drawText(nome, { x: 32, y: 695, ...estilo });
  page.drawText(nascimento, { x: 371, y: 695, ...estilo });
  page.drawText(cpf, { x: 32, y: 657, ...estilo });
  page.drawText(telefone, { x: 371, y: 657, ...estilo });
  page.drawText(endereco, { x: 32, y: 622, ...estilo });
  page.drawText(cidade, { x: 32, y: 607, ...estilo });
  page.drawText(cep, { x: 32, y: 593, ...estilo });
  page.drawText(email, { x: 371, y: 622, ...estilo });

  page.drawText(numeroReserva, { x: 391, y: 561, ...estilo }); // Número da reserva
  page.drawText(checkinFormatado, { x: 32, y: 518, ...estilo });
  page.drawText(checkoutFormatado, { x: 371, y: 518, ...estilo });
  page.drawText(numHospedes, { x: 32, y: 480, ...estilo });
  page.drawText(numCriancas, { x: 371, y: 480, ...estilo });
  page.drawText(numNoites, { x: 32, y: 444, ...estilo });
  page.drawText("R$ " + valorDiaria, { x: 371, y: 444, ...estilo });
  page.drawText("R$ " + taxaLimpeza, { x: 32, y: 406, ...estilo });
  page.drawText(desconto, { x: 213, y: 406, ...estilo });
  page.drawText("R$ " + total, { x: 371, y: 406, ...estilo });
  
  page.drawText(numParcelas, { x: 32, y: 313, ...estilo });
  page.drawText("R$ " + valorParcela, { x: 371, y: 313, ...estilo });



  // Gera e baixa o PDF
  const pdfBytes = await pdfDoc.save();
  const blob = new Blob([pdfBytes], { type: 'application/pdf' });
  const url = URL.createObjectURL(blob);

  const a = document.createElement("a");
  a.href = url;
  a.download = "reserva-casa-do-mar.pdf";
  a.click();
  URL.revokeObjectURL(url);
}



 // Salvar JSON

function salvarJSON() {
    const dadosReserva = {
        numeroReserva: document.getElementById('numeroReserva').textContent,
        nomeHospede: document.getElementById('nomeHospede').value,
        nascimentoHospede: document.getElementById('nascimentoHospede').value,
        cpfHospede: document.getElementById('cpfHospede').value,
        enderecoHospede: document.getElementById('enderecoHospede').value,
        cepHospede: document.getElementById('cepHospede').value,
        cidadeHospede: document.getElementById('cidadeHospede').value,
        telefoneHospede: document.getElementById('telefoneHospede').value,
        emailHospede: document.getElementById('emailHospede').value,
        checkin: document.getElementById('checkin').value,
        checkout: document.getElementById('checkout').value,
        numNoites: document.getElementById('numNoites').value,
        numHospedes: document.getElementById('hospedes').value,
        numCriancas: document.getElementById('criancas').value,
        valorDiaria: document.getElementById('valorDiaria').value,
        taxaLimpeza: document.getElementById('taxaLimpeza').value,
        desconto: document.getElementById('desconto').value,
        total: document.getElementById('valorTotal').value,
        numParcelas: document.getElementById('numParcelas').value,
        valorParcela: document.getElementById('valorParcela').value
    };

    const json = JSON.stringify(dadosReserva, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'reserva.json';
    a.click();
    URL.revokeObjectURL(url);
}


// Carregar JSON

function carregarJSON() {
    const input = document.getElementById('arquivoJSON');
    const file = input.files[0];
    const reader = new FileReader();

    reader.onload = function(event) {
        const json = event.target.result;
        const dadosReserva = JSON.parse(json);

        document.getElementById('numeroReserva').textContent = dadosReserva.numeroReserva;
        document.getElementById('nomeHospede').value = dadosReserva.nomeHospede;
        document.getElementById('nascimentoHospede').value = dadosReserva.nascimentoHospede;
        document.getElementById('cpfHospede').value = dadosReserva.cpfHospede;
        document.getElementById('enderecoHospede').value = dadosReserva.enderecoHospede;
        document.getElementById('cepHospede').value = dadosReserva.cepHospede;
        document.getElementById('cidadeHospede').value = dadosReserva.cidadeHospede;
        document.getElementById('telefoneHospede').value = dadosReserva.telefoneHospede;
        document.getElementById('emailHospede').value = dadosReserva.emailHospede;
        document.getElementById('checkin').value = dadosReserva.checkin;
        document.getElementById('checkout').value = dadosReserva.checkout;
        document.getElementById('numNoites').value = dadosReserva.numNoites;
        document.getElementById('hospedes').value = dadosReserva.numHospedes;
        document.getElementById('criancas').value = dadosReserva.numCriancas;
        document.getElementById('valorDiaria').value = dadosReserva.valorDiaria;
        document.getElementById('taxaLimpeza').value = dadosReserva.taxaLimpeza;
        document.getElementById('desconto').value = dadosReserva.desconto;
        document.getElementById('valorTotal').value = dadosReserva.total;
        document.getElementById('numParcelas').value = dadosReserva.numParcelas;

        // Valor da parcela: usa o do JSON se existir, senão calcula automaticamente
        if (dadosReserva.valorParcela) {
            document.getElementById('valorParcela').value = dadosReserva.valorParcela;
        } else {
            calcularValorParcela();
        }
    };

    reader.readAsText(file);
}

document.getElementById('checkin').addEventListener('change', atualizarNumeroReserva);



</script>

</body>
</html>
